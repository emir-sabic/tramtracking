const axios = require('axios');

const trams = [
    {
        tramId: 'tram1',
        route: [
            { lat: 43.83094844622712, lng: 18.308908017644235 },
            { lat: 43.83064255858134, lng: 18.309205738365346 },
            { lat: 43.83047659760614, lng: 18.30961623208348 },
            { lat: 43.83066533750274, lng: 18.309751559682866 },
            { lat: 43.83089963447503, lng: 18.309345576884713 },
            { lat: 43.83101027439223, lng: 18.309129052725698 },
            { lat: 43.83112742231629, lng: 18.308944105006542 },
            { lat: 43.831339115946996, lng: 18.308845453897028 },
            { lat: 43.831479041836374, lng: 18.308868008496926 },
            { lat: 43.83175563855954, lng: 18.308881541256866 },
            { lat: 43.83215914206839, lng: 18.309052956216085 },
            { lat: 43.832432481605004, lng: 18.309513070053992 },
            { lat: 43.83277272197547, lng: 18.310133708987124 },
            { lat: 43.83300119220473, lng: 18.31056146536376 },
            { lat: 43.83336778851818, lng: 18.31121583027645 },
            { lat: 43.83374265539773, lng: 18.311902402452134 },
            { lat: 43.83391134800814, lng: 18.312178790858944 },
            { lat: 43.834174481946135, lng: 18.312565028964652 },
            { lat: 43.83442351021329, lng: 18.3129382339841 },
            { lat: 43.83460543599912, lng: 18.31325068692109 },
            { lat: 43.834907251456215, lng: 18.313637103862366 },
            { lat: 43.83530020791119, lng: 18.314239144539883 },
            { lat: 43.835692656609545, lng: 18.31479336078602 },
            { lat: 43.83614614539875, lng: 18.315467933591826 },
            { lat: 43.836391856903056, lng: 18.315781752043666 },
            { lat: 43.83666271879763, lng: 18.316162625731238 },
            { lat: 43.837018706858316, lng: 18.31666956323048 },
            { lat: 43.83741532148561, lng: 18.31725160258618 },
            { lat: 43.837794521298385, lng: 18.317828277520757 },
            { lat: 43.83803829132845, lng: 18.318182329117658 },
            { lat: 43.83834396980866, lng: 18.318678537786845 },
            { lat: 43.83881409251311, lng: 18.319434920730874 },
            { lat: 43.83933838136484, lng: 18.320124248448913 },
            { lat: 43.8398026923695, lng: 18.320655325831325 },
            { lat: 43.8403811414413, lng: 18.32134733575338 },
            { lat: 43.84099440740847, lng: 18.322211007051866 },
            { lat: 43.841518677104794, lng: 18.32322219983836 },
            { lat: 43.84198684023897, lng: 18.32463304179012 },
            { lat: 43.842318290663975, lng: 18.32615101976152 },
            { lat: 43.84261155673261, lng: 18.3276203759845 },
            { lat: 43.842921080818805, lng: 18.32905535781612 },
            { lat: 43.84315515734525, lng: 18.330197978854997 },
            { lat: 43.84345887510497, lng: 18.331611503006783 },
            { lat: 43.84375485334435, lng: 18.33300625169836 },
            { lat: 43.843928957510364, lng: 18.333797503356198 },
            { lat: 43.84411660253645, lng: 18.334698725582992 },
            { lat: 43.84432552620229, lng: 18.335726011642368 },
            { lat: 43.844441594590805, lng: 18.336198080426207 },
            { lat: 43.8446088593757, lng: 18.337010432994276 },
            { lat: 43.84480313617273, lng: 18.338140920962758 },
            { lat: 43.84496479024472, lng: 18.339136220143637 },
            { lat: 43.84510727771643, lng: 18.34005330062645 },
            { lat: 43.84522927797523, lng: 18.340842711605507 },
            { lat: 43.84533156996128, lng: 18.341629882065387 },
            { lat: 43.8454874209825, lng: 18.34264120111852 },
            { lat: 43.84574888408439, lng: 18.34439347837956 },
            { lat: 43.84596407456072, lng: 18.345704923128547 }
        ],
        index: 0
    },
    {
        tramId: 'tram2',
        route: [
            { lat: 43.83104844622712, lng: 18.309008017644235 }
            /*
            { lat: 43.83074255858134, lng: 18.309305738365346 },
            { lat: 43.83057659760614, lng: 18.30971623208348 },
            { lat: 43.83076533750274, lng: 18.309851559682866 },
            { lat: 43.83099963447503, lng: 18.309445576884713 },
            { lat: 43.83111027439223, lng: 18.309229052725698 },
            { lat: 43.83122742231629, lng: 18.309044105006542 },
            { lat: 43.831439115946996, lng: 18.308945453897028 },
            { lat: 43.831579041836374, lng: 18.308968008496926 },
            { lat: 43.83185563855954, lng: 18.308981541256866 },
            { lat: 43.83225914206839, lng: 18.309152956216085 },
            { lat: 43.832532481605004, lng: 18.309613070053992 },
            { lat: 43.83287272197547, lng: 18.310233708987124 },
            { lat: 43.83310119220473, lng: 18.31066146536376 },
            { lat: 43.83346778851818, lng: 18.31131583027645 },
            { lat: 43.83384265539773, lng: 18.312002402452134 },
            { lat: 43.83401134800814, lng: 18.312278790858944 },
            { lat: 43.834274481946135, lng: 18.312665028964652 },
            { lat: 43.83452351021329, lng: 18.3130382339841 },
            { lat: 43.83470543599912, lng: 18.31335068692109 },
            { lat: 43.835007251456215, lng: 18.313737103862366 },
            { lat: 43.83540020791119, lng: 18.314339144539883 },
            { lat: 43.835792656609545, lng: 18.31489336078602 },
            { lat: 43.83624614539875, lng: 18.315567933591826 },
            { lat: 43.836491856903056, lng: 18.315881752043666 },
            { lat: 43.83676271879763, lng: 18.316262625731238 },
            { lat: 43.837118706858316, lng: 18.31676956323048 },
            { lat: 43.83751532148561, lng: 18.31735160258618 },
            { lat: 43.837894521298385, lng: 18.317928277520757 },
            { lat: 43.83813829132845, lng: 18.318282329117658 },
            { lat: 43.83844396980866, lng: 18.318778537786845 },
            { lat: 43.83891409251311, lng: 18.319534920730874 },
            { lat: 43.83943838136484, lng: 18.320224248448913 },
            { lat: 43.8399026923695, lng: 18.320755325831325 },
            { lat: 43.8404811414413, lng: 18.32144733575338 },
            { lat: 43.84109440740847, lng: 18.322311007051866 },
            { lat: 43.841618677104794, lng: 18.32332219983836 },
            { lat: 43.84208684023897, lng: 18.32473304179012 },
            { lat: 43.842418290663975, lng: 18.32625101976152 },
            { lat: 43.84271155673261, lng: 18.3277203759845 },
            { lat: 43.843021080818805, lng: 18.32915535781612 },
            { lat: 43.84325515734525, lng: 18.330297978854997 },
            { lat: 43.84355887510497, lng: 18.331711503006783 },
            { lat: 43.84385485334435, lng: 18.33310625169836 },
            { lat: 43.844028957510364, lng: 18.333897503356198 },
            { lat: 43.84421660253645, lng: 18.334798725582992 },
            { lat: 43.84442552620229, lng: 18.335826011642368 },
            { lat: 43.844541594590805, lng: 18.336298080426207 },
            { lat: 43.8447088593757, lng: 18.337110432994276 },
            { lat: 43.84490313617273, lng: 18.338240920962758 },
            { lat: 43.84506479024472, lng: 18.339236220143637 },
            { lat: 43.84520727771643, lng: 18.34015330062645 },
            { lat: 43.84532927797523, lng: 18.340942711605507 },
            { lat: 43.84543156996128, lng: 18.341729882065387 },
            { lat: 43.8455874209825, lng: 18.34274120111852 },
            { lat: 43.84584888408439, lng: 18.34449347837956 },
            { lat: 43.84606407456072, lng: 18.345804923128547 }
            */
        ],
        index: 0
    }
];

const speed = 30; // Speed in km/h

function sendGpsData() {
    trams.forEach(tram => {
        if (!tram.stationary) {
            if (tram.index >= tram.route.length) tram.index = 0;

            const { lat, lng } = tram.route[tram.index];
            tram.index++;

            axios.post('http://localhost:3000/api/gps', {
                tramId: tram.tramId,
                lat,
                lng,
                speed
            })
            .then(response => {
                console.log(`Sent GPS data for ${tram.tramId}: ${lat}, ${lng}`);
            })
            .catch(error => {
                console.error(`Error sending GPS data for ${tram.tramId}:`, error);
            });
        } else {
            const { lat, lng } = tram.route[tram.index];

            axios.post('http://localhost:3000/api/gps', {
                tramId: tram.tramId,
                lat,
                lng,
                speed
            })
            .then(response => {
                console.log(`Sent stationary GPS data for ${tram.tramId}: ${lat}, ${lng}`);
            })
            .catch(error => {
                console.error(`Error sending GPS data for ${tram.tramId}:`, error);
            });
        }
    });
}

setInterval(sendGpsData, 3000); // Send data every 3 seconds
